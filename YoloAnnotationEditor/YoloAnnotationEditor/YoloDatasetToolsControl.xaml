<UserControl x:Class="YoloAnnotationEditor.YoloDatasetToolsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="0,0,0,5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Padding" Value="0,5"/>
        </Style>
    </UserControl.Resources>

    <TabControl>
        <!-- Merge Datasets Tab -->
        <TabItem Header="Merge Datasets">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Merge Multiple YOLO Datasets" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="150"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtMergeOutput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseMergeOutput" Content="Browse..." Click="BrowseMergeOutput_Click"/>

                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Name="btnAddMergeDataset" Content="Add Dataset Folder" Click="AddMergeDataset_Click"/>
                            <Button Name="btnRemoveMergeDataset" Content="Remove Selected" Click="RemoveMergeDataset_Click"/>
                            <Button Name="btnClearMergeDatasets" Content="Clear All" Click="ClearMergeDatasets_Click"/>
                        </StackPanel>

                        <ListBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Name="lstMergeDatasets" Margin="0,5,0,0"/>

                        <GroupBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Header="Merge Settings" Margin="0,10,0,0">
                            <StackPanel>
                                <CheckBox Name="chkMergeTrain" Content="Include train split" IsChecked="True" Margin="0,5,0,0"/>
                                <CheckBox Name="chkMergeVal" Content="Include val split" IsChecked="True"/>
                                <CheckBox Name="chkMergeTest" Content="Include test split" IsChecked="True"/>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                                    <Label Content="Random Seed (optional):"/>
                                    <TextBox Name="txtMergeSeed" Width="100"/>
                                </StackPanel>

                                <Button Name="btnMergeDatasets" Content="Merge Datasets" Click="MergeDatasets_Click" 
                                        HorizontalAlignment="Left" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <TextBox Name="txtMergeLog" Height="200" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Split Datasets Tab -->
        <TabItem Header="Split Datasets">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Split YOLO Dataset" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Input Dataset:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtSplitInput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseSplitInput" Content="Browse..." Click="BrowseSplitInput_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtSplitOutput" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseSplitOutput" Content="Browse..." Click="BrowseSplitOutput_Click"/>

                        <GroupBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Header="Split Options" Margin="0,10,0,0">
                            <StackPanel>
                                <RadioButton Name="rbSplitIntoParts" Content="Split into N equal parts" IsChecked="True" Margin="0,5,0,0"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Number of parts:"/>
                                    <TextBox Name="txtSplitParts" Text="3" Width="60"/>
                                </StackPanel>

                                <RadioButton Name="rbSplitByCount" Content="Split by image count"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Images per part:"/>
                                    <TextBox Name="txtSplitCount" Text="1000" Width="80"/>
                                </StackPanel>

                                <RadioButton Name="rbExtractSubset" Content="Extract random subset"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Number of images:"/>
                                    <TextBox Name="txtSubsetCount" Text="5000" Width="80"/>
                                </StackPanel>

                                <Separator Margin="0,10,0,10"/>

                                <CheckBox Name="chkSplitTrain" Content="Include train split" IsChecked="True"/>
                                <CheckBox Name="chkSplitVal" Content="Include val split" IsChecked="True"/>
                                <CheckBox Name="chkSplitTest" Content="Include test split" IsChecked="True"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                                    <Label Content="Random Seed (optional):"/>
                                    <TextBox Name="txtSplitSeed" Width="100"/>
                                </StackPanel>

                                <Button Name="btnSplitDataset" Content="Split Dataset" Click="SplitDataset_Click" 
                                        HorizontalAlignment="Left" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <!-- Consolidate to Train -->
                    <GroupBox Header="Consolidate to Train" Margin="0,20,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Name="txtConsolidateInput" IsReadOnly="True"/>
                            <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseConsolidate" Content="Browse..." Click="BrowseConsolidate_Click"/>

                            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Vertical" Margin="0,10,0,0">
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,10" Foreground="Gray">
                                    Moves all images and labels from val and test splits into the train split.
                                </TextBlock>
                                <Button Name="btnConsolidateToTrain" Content="Move All to Train" Click="ConsolidateToTrain_Click"
                                        HorizontalAlignment="Left"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <TextBox Name="txtSplitLog" Height="200" Margin="0,20,0,0" IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Filter Datasets Tab -->
        <TabItem Header="Filter Datasets">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Filter YOLO Dataset" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Input Dataset:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtFilterInput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseFilterInput" Content="Browse..." Click="BrowseFilterInput_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtFilterOutput" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseFilterOutput" Content="Browse..." Click="BrowseFilterOutput_Click"/>

                        <GroupBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Header="Filter Options" Margin="0,10,0,0">
                            <StackPanel>
                                <RadioButton Name="rbFilterByClass" Content="Filter by class" IsChecked="True" Margin="0,5,0,0"/>
                                <StackPanel Margin="20,5,0,5">
                                    <Button Name="btnLoadClasses" Content="Load Classes from Dataset" Click="LoadClasses_Click" 
                                            HorizontalAlignment="Left" Margin="0,0,0,5"/>
                                    <ListBox Name="lstFilterClasses" Height="120" SelectionMode="Multiple"/>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                        <RadioButton Name="rbClassContains" Content="Contains selected classes" IsChecked="True" GroupName="ClassFilter"/>
                                        <RadioButton Name="rbClassNotContains" Content="Does not contain selected classes" Margin="20,0,0,0" GroupName="ClassFilter"/>
                                    </StackPanel>
                                    
                                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                        <RadioButton Name="rbClassAnd" Content="AND (all selected)" IsChecked="True" GroupName="ClassOperation"/>
                                        <RadioButton Name="rbClassOr" Content="OR (any selected)" Margin="20,0,0,0" GroupName="ClassOperation"/>
                                    </StackPanel>
                                </StackPanel>

                                <RadioButton Name="rbFilterFirstN" Content="First N images"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Number of images:"/>
                                    <TextBox Name="txtFilterFirstN" Text="1000" Width="80"/>
                                </StackPanel>

                                <RadioButton Name="rbFilterRandomN" Content="Random N images"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Number of images:"/>
                                    <TextBox Name="txtFilterRandomN" Text="1000" Width="80"/>
                                </StackPanel>

                                <Separator Margin="0,10,0,10"/>

                                <CheckBox Name="chkFilterTrain" Content="Include train split" IsChecked="True"/>
                                <CheckBox Name="chkFilterVal" Content="Include val split" IsChecked="True"/>
                                <CheckBox Name="chkFilterTest" Content="Include test split" IsChecked="True"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                                    <Label Content="Random Seed (optional):"/>
                                    <TextBox Name="txtFilterSeed" Width="100"/>
                                </StackPanel>

                                <Button Name="btnFilterDataset" Content="Filter Dataset" Click="FilterDataset_Click"
                                        HorizontalAlignment="Left" Margin="0,10,0,0"/>

                                <StackPanel Margin="0,10,0,0">
                                    <Label Content="Status:"/>
                                    <TextBox Name="txtFilterStatus" IsReadOnly="True" Background="LightGray"/>
                                    <ProgressBar Name="pbFilterProgress" Height="20" Margin="0,5,0,0" Minimum="0" Maximum="100"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <TextBox Name="txtFilterLog" Height="200" Margin="0,20,0,0" IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Analyze Dataset Tab -->
        <TabItem Header="Analyze">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Analyze YOLO Dataset" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtAnalyzeInput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseAnalyzeInput" Content="Browse..." Click="BrowseAnalyzeInput_Click"/>

                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Name="btnAnalyzeDataset" Content="Analyze Dataset" Click="AnalyzeDataset_Click"/>
                            <Button Name="btnExportCSV" Content="Export to CSV" Click="ExportCSV_Click" IsEnabled="False"/>
                            <Button Name="btnGenerateReport" Content="Generate HTML Report" Click="GenerateReport_Click" IsEnabled="False"/>
                        </StackPanel>
                    </Grid>

                    <!-- Statistics Panel -->
                    <GroupBox Header="Dataset Statistics" Margin="0,20,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Total Images:" FontWeight="Bold" Width="150"/>
                                    <Label Name="lblTotalImages" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Total Annotations:" FontWeight="Bold" Width="150"/>
                                    <Label Name="lblTotalAnnotations" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Train Images:" FontWeight="Bold" Width="150"/>
                                    <Label Name="lblTrainImages" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Val Images:" FontWeight="Bold" Width="150"/>
                                    <Label Name="lblValImages" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Test Images:" FontWeight="Bold" Width="150"/>
                                    <Label Name="lblTestImages" Content="0"/>
                                </StackPanel>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Margin="10">
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Avg Annotations/Image:" FontWeight="Bold" Width="180"/>
                                    <Label Name="lblAvgAnnotations" Content="0.0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Min Annotations/Image:" FontWeight="Bold" Width="180"/>
                                    <Label Name="lblMinAnnotations" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Max Annotations/Image:" FontWeight="Bold" Width="180"/>
                                    <Label Name="lblMaxAnnotations" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Number of Classes:" FontWeight="Bold" Width="180"/>
                                    <Label Name="lblNumClasses" Content="0"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Class Distribution Table -->
                    <GroupBox Header="Class Distribution" Margin="0,20,0,0">
                        <DataGrid Name="dgClassDistribution" Height="300" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Class ID" Binding="{Binding ClassId}" Width="80"/>
                                <DataGridTextColumn Header="Class Name" Binding="{Binding ClassName}" Width="*"/>
                                <DataGridTextColumn Header="Instances" Binding="{Binding InstanceCount}" Width="100"/>
                                <DataGridTextColumn Header="Images" Binding="{Binding ImageCount}" Width="100"/>
                                <DataGridTextColumn Header="Percentage" Binding="{Binding Percentage, StringFormat={}{0:F2}%}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>

                    <!-- Progress Tracking -->
                    <GroupBox Header="Analysis Progress" Margin="0,20,0,0">
                        <StackPanel>
                            <TextBlock Name="txtAnalyzeStatus" Text="Ready to analyze" Margin="5"/>
                            <ProgressBar Name="pbAnalyzeProgress" Height="25" Margin="5" Minimum="0" Maximum="100"/>
                        </StackPanel>
                    </GroupBox>

                    <TextBox Name="txtAnalyzeLog" Height="150" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Balance Dataset Tab -->
        <TabItem Header="Balance">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Balance YOLO Dataset" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Primary Dataset:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtBalancePrimary" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseBalancePrimary" Content="Browse..." Click="BrowseBalancePrimary_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Secondary Dataset (optional):"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtBalanceSecondary" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseBalanceSecondary" Content="Browse..." Click="BrowseBalanceSecondary_Click"/>

                        <Label Grid.Row="2" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="2" Grid.Column="1" Name="txtBalanceOutput" IsReadOnly="True"/>
                        <Button Grid.Row="2" Grid.Column="2" Name="btnBrowseBalanceOutput" Content="Browse..." Click="BrowseBalanceOutput_Click"/>

                        <GroupBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Header="Balance Settings" Margin="0,10,0,0">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,5,0,5">
                                    <Label Content="Target instances per class:"/>
                                    <TextBox Name="txtTargetInstances" Text="1000" Width="80"/>
                                </StackPanel>

                                <Button Name="btnBalanceDataset" Content="Balance Dataset" Click="BalanceDataset_Click" 
                                        HorizontalAlignment="Left" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <TextBox Name="txtBalanceLog" Height="200" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Validate Dataset Tab -->
        <TabItem Header="Validate">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Validate YOLO Dataset" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtValidateInput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseValidateInput" Content="Browse..." Click="BrowseValidateInput_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtValidateOutput" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseValidateOutput" Content="Browse..." Click="BrowseValidateOutput_Click"/>

                        <GroupBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Header="Validation Rules" Margin="0,10,0,0">
                            <StackPanel>
                                <CheckBox Name="chkValidateMinROI" Content="Check minimum ROI count" IsChecked="True"/>
                                <StackPanel Orientation="Horizontal" Margin="20,0,0,5">
                                    <Label Content="Minimum ROIs:"/>
                                    <TextBox Name="txtMinROI" Text="1" Width="60"/>
                                </StackPanel>

                                <CheckBox Name="chkValidateDuplicates" Content="Check for duplicate classes in same image" IsChecked="True"/>
                                <CheckBox Name="chkValidateCoordinates" Content="Check for invalid coordinates" IsChecked="True"/>
                                <CheckBox Name="chkValidateMissingFiles" Content="Check for missing labels/images" IsChecked="True"/>
                                <CheckBox Name="chkValidateEmptyLabels" Content="Check for empty label files" IsChecked="True"/>

                                <Separator Margin="0,10,0,10"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Name="btnValidateDataset" Content="Validate Dataset" Click="ValidateDataset_Click"/>
                                    <Button Name="btnExportGoodDataset" Content="Export Good Images" Click="ExportGoodDataset_Click" IsEnabled="False" Margin="5,0,0,0"/>
                                    <Button Name="btnExportBadDataset" Content="Export Bad Images" Click="ExportBadDataset_Click" IsEnabled="False" Margin="5,0,0,0"/>
                                    <Button Name="btnExportValidationReport" Content="Export Report" Click="ExportValidationReport_Click" IsEnabled="False" Margin="5,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <!-- Validation Statistics Chart -->
                    <GroupBox Header="Validation Statistics" Margin="0,20,0,0">
                        <Grid Height="200">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Fine -->
                            <StackPanel Grid.Column="0" Margin="5">
                                <TextBlock Text="Fine" HorizontalAlignment="Center" FontWeight="Bold" Foreground="Green"/>
                                <Border BorderBrush="Green" BorderThickness="2" Margin="0,5,0,0">
                                    <Grid>
                                        <Rectangle Name="barFine" Fill="LightGreen" VerticalAlignment="Bottom" Height="0"/>
                                    </Grid>
                                </Border>
                                <TextBlock Name="lblFineCount" Text="0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                            
                            <!-- Minimum ROI -->
                            <StackPanel Grid.Column="1" Margin="5">
                                <TextBlock Text="Min ROI" HorizontalAlignment="Center" FontWeight="Bold" Foreground="Orange"/>
                                <Border BorderBrush="Orange" BorderThickness="2" Margin="0,5,0,0">
                                    <Grid>
                                        <Rectangle Name="barMinROI" Fill="LightYellow" VerticalAlignment="Bottom" Height="0"/>
                                    </Grid>
                                </Border>
                                <TextBlock Name="lblMinROICount" Text="0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                            
                            <!-- Duplicates -->
                            <StackPanel Grid.Column="2" Margin="5">
                                <TextBlock Text="Duplicates" HorizontalAlignment="Center" FontWeight="Bold" Foreground="DarkOrange"/>
                                <Border BorderBrush="DarkOrange" BorderThickness="2" Margin="0,5,0,0">
                                    <Grid>
                                        <Rectangle Name="barDuplicates" Fill="PeachPuff" VerticalAlignment="Bottom" Height="0"/>
                                    </Grid>
                                </Border>
                                <TextBlock Name="lblDuplicatesCount" Text="0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                            
                            <!-- Invalid Coordinates -->
                            <StackPanel Grid.Column="3" Margin="5">
                                <TextBlock Text="Invalid Coords" HorizontalAlignment="Center" FontWeight="Bold" Foreground="Red"/>
                                <Border BorderBrush="Red" BorderThickness="2" Margin="0,5,0,0">
                                    <Grid>
                                        <Rectangle Name="barInvalidCoords" Fill="LightCoral" VerticalAlignment="Bottom" Height="0"/>
                                    </Grid>
                                </Border>
                                <TextBlock Name="lblInvalidCoordsCount" Text="0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                            
                            <!-- Missing Files -->
                            <StackPanel Grid.Column="4" Margin="5">
                                <TextBlock Text="Missing Files" HorizontalAlignment="Center" FontWeight="Bold" Foreground="Purple"/>
                                <Border BorderBrush="Purple" BorderThickness="2" Margin="0,5,0,0">
                                    <Grid>
                                        <Rectangle Name="barMissingFiles" Fill="Plum" VerticalAlignment="Bottom" Height="0"/>
                                    </Grid>
                                </Border>
                                <TextBlock Name="lblMissingFilesCount" Text="0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                            
                            <!-- Empty Labels -->
                            <StackPanel Grid.Column="5" Margin="5">
                                <TextBlock Text="Empty Labels" HorizontalAlignment="Center" FontWeight="Bold" Foreground="Gray"/>
                                <Border BorderBrush="Gray" BorderThickness="2" Margin="0,5,0,0">
                                    <Grid>
                                        <Rectangle Name="barEmptyLabels" Fill="LightGray" VerticalAlignment="Bottom" Height="0"/>
                                    </Grid>
                                </Border>
                                <TextBlock Name="lblEmptyLabelsCount" Text="0" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Validation Results -->
                    <GroupBox Header="Validation Results" Margin="0,20,0,0">
                        <DataGrid Name="dgValidationResults" Height="250" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Image" Binding="{Binding ImagePath}" Width="*"/>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="150"/>
                                <DataGridTextColumn Header="Issues" Binding="{Binding Issues.Count}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>

                    <!-- Progress Tracking -->
                    <GroupBox Header="Validation Progress" Margin="0,20,0,0">
                        <StackPanel>
                            <TextBlock Name="txtValidateStatus" Text="Ready to validate" Margin="5"/>
                            <ProgressBar Name="pbValidateProgress" Height="25" Margin="5" Minimum="0" Maximum="100"/>
                        </StackPanel>
                    </GroupBox>

                    <TextBox Name="txtValidateLog" Height="150" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Utilities Tab -->
        <TabItem Header="Utilities">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Dataset Utilities" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <!-- Label-Image Matcher -->
                    <GroupBox Header="Label-Image Matcher" Margin="0,0,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Mode:"/>
                            <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal">
                                <RadioButton Name="rbMatchLabelsToImages" Content="Match Labels → Images" IsChecked="True" GroupName="MatchMode"/>
                                <RadioButton Name="rbMatchImagesToLabels" Content="Match Images → Labels" Margin="20,0,0,0" GroupName="MatchMode"/>
                            </StackPanel>

                            <Label Grid.Row="1" Grid.Column="0" Content="Source Directory:"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Name="txtMatchSource" IsReadOnly="True"/>
                            <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseMatchSource" Content="Browse..." Click="BrowseMatchSource_Click"/>

                            <Label Grid.Row="2" Grid.Column="0" Content="Target Directory:"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Name="txtMatchTarget" IsReadOnly="True"/>
                            <Button Grid.Row="2" Grid.Column="2" Name="btnBrowseMatchTarget" Content="Browse..." Click="BrowseMatchTarget_Click"/>

                            <Button Grid.Row="3" Grid.Column="1" Name="btnRunMatcher" Content="Run Matcher" Click="RunMatcher_Click" 
                                    HorizontalAlignment="Left" Margin="0,10,0,0"/>
                        </Grid>
                    </GroupBox>

                    <!-- Find Missing Files -->
                    <GroupBox Header="Find Missing Files" Margin="0,10,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Name="txtMissingFilesInput" IsReadOnly="True"/>
                            <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseMissingFiles" Content="Browse..." Click="BrowseMissingFiles_Click"/>

                            <Button Grid.Row="1" Grid.Column="1" Name="btnFindMissingFiles" Content="Find Missing Files" Click="FindMissingFiles_Click" 
                                    HorizontalAlignment="Left" Margin="0,10,0,0"/>
                        </Grid>
                    </GroupBox>

                    <!-- Cleanup Tool -->
                    <GroupBox Header="Cleanup Tool" Margin="0,10,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Name="txtCleanupInput" IsReadOnly="True"/>
                            <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseCleanup" Content="Browse..." Click="BrowseCleanup_Click"/>

                            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,10,0,0">
                                <CheckBox Name="chkRemoveImagesWithoutLabels" Content="Remove images without labels"/>
                                <CheckBox Name="chkRemoveLabelsWithoutImages" Content="Remove labels without images"/>
                                <CheckBox Name="chkRemoveEmptyLabels" Content="Remove empty label files"/>
                                <Button Name="btnRunCleanup" Content="Run Cleanup" Click="RunCleanup_Click" 
                                        HorizontalAlignment="Left" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Class Remapping -->
                    <GroupBox Header="Class Remapping" Margin="0,10,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Name="txtRemapInput" IsReadOnly="True"/>
                            <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseRemap" Content="Browse..." Click="BrowseRemap_Click"/>

                            <Label Grid.Row="1" Grid.Column="0" Content="Remapping:"/>
                            <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal">
                                <Label Content="Old Class ID:"/>
                                <TextBox Name="txtOldClassId" Width="60"/>
                                <Label Content="→ New Class ID:"/>
                                <TextBox Name="txtNewClassId" Width="60"/>
                                <Button Name="btnAddRemapRule" Content="Add Rule" Click="AddRemapRule_Click"/>
                            </StackPanel>

                            <ListBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Name="lstRemapRules" Height="80" Margin="0,5,0,0"/>

                            <Button Grid.Row="2" Grid.Column="1" Name="btnApplyRemap" Content="Apply Remapping" Click="ApplyRemap_Click" 
                                    HorizontalAlignment="Left" Margin="0,10,0,0" VerticalAlignment="Bottom"/>
                        </Grid>
                    </GroupBox>

                    <!-- Image Resizing -->
                    <GroupBox Header="Image Resizing" Margin="0,10,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Name="txtResizeInput" IsReadOnly="True"/>
                            <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseResize" Content="Browse..." Click="BrowseResize_Click"/>

                            <Label Grid.Row="1" Grid.Column="0" Content="Output Directory:"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Name="txtResizeOutput" IsReadOnly="True"/>
                            <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseResizeOutput" Content="Browse..." Click="BrowseResizeOutput_Click"/>

                            <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,10,0,0">
                                <Label Content="Target Size:"/>
                                <TextBox Name="txtResizeWidth" Text="640" Width="60"/>
                                <Label Content="x"/>
                                <TextBox Name="txtResizeHeight" Text="640" Width="60"/>
                                <CheckBox Name="chkMaintainAspect" Content="Maintain aspect ratio" IsChecked="True" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                <Button Name="btnResizeImages" Content="Resize Images" Click="ResizeImages_Click" Margin="10,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Dataset Deduplication -->
                    <GroupBox Header="Dataset Deduplication" Margin="0,10,0,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                            <TextBox Grid.Row="0" Grid.Column="1" Name="txtDedupeInput" IsReadOnly="True"/>
                            <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseDedupe" Content="Browse..." Click="BrowseDedupe_Click"/>

                            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,10,0,0">
                                <RadioButton Name="rbHashBased" Content="Hash-based (exact duplicates)" IsChecked="True" GroupName="DedupeMethod"/>
                                <Button Name="btnRunDedupe" Content="Find Duplicates" Click="RunDedupe_Click" Margin="20,0,0,0"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <TextBox Name="txtUtilitiesLog" Height="150" Margin="0,20,0,0" IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Decimal Separator Tab -->
        <TabItem Header="Decimal Separator">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Convert Decimal Separators in YOLO Labels" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                    <TextBlock Text="YOLO format requires dot (.) as decimal separator. Use these tools to convert between comma and dot separators."
                               TextWrapping="Wrap" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Dataset YAML File:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtDecimalSeparatorInput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseDecimalSeparatorInput" Content="Browse..." Click="BrowseDecimalSeparatorInput_Click"/>

                        <GroupBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Header="Conversion Options" Margin="0,10,0,0">
                            <StackPanel>
                                <TextBlock Text="Select the conversion direction:" Margin="0,5,0,10"/>

                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                    <Button Name="btnConvertCommaToDot" Content="Convert Comma (,) to Dot (.)"
                                            Click="ConvertCommaToDot_Click" MinWidth="200" Padding="10,5"/>
                                    <TextBlock Text="Use this to fix datasets with European decimal format"
                                               VerticalAlignment="Center" Margin="10,0,0,0" Foreground="Gray"/>
                                </StackPanel>

                                <StackPanel Orientation="Horizontal" Margin="0,5">
                                    <Button Name="btnConvertDotToComma" Content="Convert Dot (.) to Comma (,)"
                                            Click="ConvertDotToComma_Click" MinWidth="200" Padding="10,5"/>
                                    <TextBlock Text="Convert to European decimal format (not recommended)"
                                               VerticalAlignment="Center" Margin="10,0,0,0" Foreground="Gray"/>
                                </StackPanel>

                                <Separator Margin="0,15,0,10"/>

                                <CheckBox Name="chkDecimalSeparatorTrain" Content="Include train split" IsChecked="True" Margin="0,5"/>
                                <CheckBox Name="chkDecimalSeparatorVal" Content="Include val split" IsChecked="True" Margin="0,5"/>
                                <CheckBox Name="chkDecimalSeparatorTest" Content="Include test split" IsChecked="True" Margin="0,5"/>

                                <StackPanel Margin="0,15,0,0">
                                    <Label Content="Status:"/>
                                    <TextBox Name="txtDecimalSeparatorStatus" IsReadOnly="True" Background="LightGray"/>
                                    <ProgressBar Name="pbDecimalSeparatorProgress" Height="20" Margin="0,5,0,0" Minimum="0" Maximum="100"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <TextBox Name="txtDecimalSeparatorLog" Height="200" Margin="0,20,0,0" IsReadOnly="True"
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
    </TabControl>
</UserControl>
