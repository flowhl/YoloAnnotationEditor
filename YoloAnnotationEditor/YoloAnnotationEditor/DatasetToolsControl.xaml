<UserControl x:Class="YoloAnnotationEditor.DatasetToolsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

    <UserControl.Resources>
        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
        </Style>
        <Style TargetType="Button">
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="MinWidth" Value="80"/>
        </Style>
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="0,0,0,5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style TargetType="Label">
            <Setter Property="Padding" Value="0,5"/>
        </Style>
    </UserControl.Resources>

    <TabControl>
        <!-- Convert TRDG to PaddleOCR Tab -->
        <TabItem Header="Convert to PaddleOCR">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Convert TRDG Dataset to PaddleOCR Format" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="TRDG Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtTrdgDir" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseTrdg" Content="Browse..." Click="BrowseTrdgDir_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtConvertOutput" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseConvertOutput" Content="Browse..." Click="BrowseConvertOutput_Click"/>

                        <Label Grid.Row="2" Grid.Column="0" Content="Train/Val Split:"/>
                        <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal">
                            <Slider Name="sliderSplitRatio" Value="0.8" Minimum="0.1" Maximum="0.9" Width="200" 
                                    TickPlacement="BottomRight" TickFrequency="0.1" IsSnapToTickEnabled="True"/>
                            <TextBlock Text="{Binding ElementName=sliderSplitRatio, Path=Value, StringFormat='{}{0:P0}'}" 
                                       VerticalAlignment="Center" Margin="10,0,0,0"/>
                        </StackPanel>

                        <Button Grid.Row="3" Grid.Column="1" Name="btnConvert" Content="Convert Dataset" 
                                Click="ConvertDataset_Click" HorizontalAlignment="Left" Margin="0,10,0,0"/>
                    </Grid>

                    <TextBox Name="txtConvertLog" Height="200" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Merge Datasets Tab -->
        <TabItem Header="Merge Datasets">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Merge Multiple Datasets" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="150"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Output Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtMergeOutput" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseMergeOutput" Content="Browse..." Click="BrowseMergeOutput_Click"/>

                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Orientation="Horizontal" Margin="0,10,0,0">
                            <Button Name="btnAutoDiscover" Content="Auto-Discover Datasets" Click="AutoDiscoverDatasets_Click"/>
                            <Button Name="btnAddDataset" Content="Add Dataset Folder" Click="AddDatasetFolder_Click"/>
                            <Button Name="btnRemoveDataset" Content="Remove Selected" Click="RemoveDataset_Click"/>
                            <Button Name="btnClearDatasets" Content="Clear All" Click="ClearDatasets_Click"/>
                        </StackPanel>

                        <ListBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Name="lstDatasets" Margin="0,5,0,0"/>

                        <!-- Merge Settings -->
                        <GroupBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" Header="Merge Settings" Margin="0,10,0,0">
                            <StackPanel>
                                <RadioButton Name="rbFixedHeight" Content="Fixed Height" IsChecked="False" Margin="0,5,0,0"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Height:"/>
                                    <TextBox Name="txtFixedHeight" Text="32" Width="60"/>
                                    <Label Content="pixels"/>
                                </StackPanel>

                                <RadioButton Name="rbVariableHeight" Content="Variable Height Range"/>
                                <StackPanel Orientation="Horizontal" Margin="20,5,0,5">
                                    <Label Content="Min:"/>
                                    <TextBox Name="txtMinHeight" Text="14" Width="60"/>
                                    <Label Content="Max:"/>
                                    <TextBox Name="txtMaxHeight" Text="20" Width="60"/>
                                    <Label Content="pixels"/>
                                </StackPanel>

                                <RadioButton Name="rbNoScale" Content="No Scaling (Keep Original Size)" IsChecked="True"/>

                                <StackPanel Orientation="Horizontal" Margin="0,10,0,5">
                                    <Label Content="JPEG Quality:"/>
                                    <TextBox Name="txtQuality" Text="95" Width="60"/>
                                    <Label Content="Random Seed (optional):"/>
                                    <TextBox Name="txtSeed" Width="100"/>
                                </StackPanel>

                                <Button Name="btnMergeDatasets" Content="Merge Datasets" Click="MergeDatasets_Click" 
                                        HorizontalAlignment="Left" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <TextBox Name="txtMergeLog" Height="200" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Generate Character Set Tab -->
        <TabItem Header="Generate Character Set">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Generate Character Dictionary" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtCharsetDatasetDir" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseCharsetDataset" Content="Browse..." Click="BrowseCharsetDataset_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Output File:"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtCharsetOutput" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseCharsetOutput" Content="Browse..." Click="BrowseCharsetOutput_Click"/>

                        <Button Grid.Row="2" Grid.Column="1" Name="btnGenerateCharset" Content="Generate Character Set" 
                                Click="GenerateCharset_Click" HorizontalAlignment="Left" Margin="0,10,0,0"/>
                    </Grid>

                    <TextBox Name="txtCharsetLog" Height="200" Margin="0,20,0,0" IsReadOnly="True" 
                             VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"/>

                    <GroupBox Header="Character Set Preview" Margin="0,20,0,0">
                        <TextBox Name="txtCharsetPreview" Height="100" IsReadOnly="True" TextWrapping="Wrap" 
                                 VerticalScrollBarVisibility="Auto"/>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </TabItem>

        <!-- Analyze Dataset Tab -->
        <TabItem Header="Analyze Dataset">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="20">
                    <TextBlock Text="Dataset Analysis" FontSize="16" FontWeight="Bold" Margin="0,0,0,20"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Dataset Directory:"/>
                        <TextBox Grid.Row="0" Grid.Column="1" Name="txtAnalyzeDatasetDir" IsReadOnly="True"/>
                        <Button Grid.Row="0" Grid.Column="2" Name="btnBrowseAnalyzeDataset" Content="Browse..." Click="BrowseAnalyzeDataset_Click"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Dictionary File (optional):"/>
                        <TextBox Grid.Row="1" Grid.Column="1" Name="txtDictionaryPath" IsReadOnly="True"/>
                        <Button Grid.Row="1" Grid.Column="2" Name="btnBrowseDictionary" Content="Browse..." Click="BrowseDictionary_Click"/>

                        <Button Grid.Row="2" Grid.Column="1" Name="btnAnalyzeDataset" Content="Analyze Dataset" 
                                Click="AnalyzeDataset_Click" HorizontalAlignment="Left" Margin="0,10,0,0"/>
                    </Grid>

                    <Grid Margin="0,20,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>

                        <GroupBox Grid.Column="0" Header="Dataset Statistics" Margin="0,0,10,0">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Total Samples:" FontWeight="Bold"/>
                                    <Label Name="lblTotalSamples" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Unique Characters:" FontWeight="Bold"/>
                                    <Label Name="lblUniqueChars" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Avg Label Length:" FontWeight="Bold"/>
                                    <Label Name="lblAvgLength" Content="0.0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Min Length:" FontWeight="Bold"/>
                                    <Label Name="lblMinLength" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Max Length:" FontWeight="Bold"/>
                                    <Label Name="lblMaxLength" Content="0"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Grid.Column="1" Header="Character Breakdown" Margin="10,0,0,0">
                            <StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Letters:" FontWeight="Bold"/>
                                    <Label Name="lblLetters" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Digits:" FontWeight="Bold"/>
                                    <Label Name="lblDigits" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Punctuation:" FontWeight="Bold"/>
                                    <Label Name="lblPunctuation" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Spaces:" FontWeight="Bold"/>
                                    <Label Name="lblSpaces" Content="0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal">
                                    <Label Content="Others:" FontWeight="Bold"/>
                                    <Label Name="lblOthers" Content="0"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </Grid>

                    <GroupBox Header="Character Frequency" Margin="0,20,0,0">
                        <DataGrid Name="dgCharacterFrequency" Height="250" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Character" Binding="{Binding Character}" Width="80"/>
                                <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="80"/>
                                <DataGridTextColumn Header="Percentage" Binding="{Binding Percentage}" Width="100"/>
                                <DataGridTextColumn Header="In Dictionary" Binding="{Binding InDictionary}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>

                    <GroupBox Header="Dictionary Comparison" Margin="0,20,0,0" Name="gbDictionaryComparison" Visibility="Collapsed">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>

                            <GroupBox Grid.Column="0" Header="Missing from Dictionary" Margin="0,0,5,0">
                                <ListBox Name="lstMissingFromDict" Height="150"/>
                            </GroupBox>

                            <GroupBox Grid.Column="1" Header="Missing from Dataset" Margin="5,0,0,0">
                                <ListBox Name="lstMissingFromDataset" Height="150"/>
                            </GroupBox>
                        </Grid>
                    </GroupBox>

                    <GroupBox Header="Sample Labels" Margin="0,20,0,0">
                        <ListBox Name="lstSampleLabels" Height="150"/>
                    </GroupBox>

                    <GroupBox Header="Recommendations" Margin="0,20,0,0">
                        <TextBox Name="txtRecommendations" Height="100" IsReadOnly="True" TextWrapping="Wrap" 
                                 VerticalScrollBarVisibility="Auto"/>
                    </GroupBox>
                </StackPanel>
            </ScrollViewer>
        </TabItem>
    </TabControl>
</UserControl>